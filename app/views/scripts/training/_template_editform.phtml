<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>


  <title><?php echo $this->translation['Application Name'];?> | <?php echo $this->pageTitle; ?></title>
<!--<link rel="stylesheet" href="http://cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css" type="text/css">-->

<?php

require_once('views/helpers/ScriptContainer.php');
print ScriptContainer::$instance->renderCSSHead();
print ScriptContainer::$instance->renderJSHead();

require_once('views/helpers/TrainingViewHelper.php');

echo '<link rel="stylesheet" href="http://cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css" type="text/css">';
?>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/ui/1.12.0/jquery-ui.min.js" integrity="sha256-eGE6blurk5sHj+rmkfsGYeKyZx3M4bG+ZlFyA7Kns7E=" crossorigin="anonymous"></script>
<script src="http://cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>

<style>
   
<?php if($this->viewonly) : ?>  
  .required { display:none; }
<?php endif; ?>

#noRecord{
  display:none;
  visible:hidden;
}
/*.ui-dialog-titlebar {
    display: none;
}
.no-close .ui-dialog-titlebar-close  {
  display: none;
}*/
</style>
<script type="text/javascript">
    
    dataTableObj = null;
    
    
    
    $(document).ready(function (){
        //This is a dataTable API for filtering rows based on content of the active field
        $.fn.dataTable.ext.search.push(
        function( settings, data, dataIndex ) {
       
        // Get the value of the user status search value set by onchange of the status select element
        var filter = document.getElementById("activeStatusText").value;
        
        var active = data[9]  || 7 ; // use data for the age column
        
        var myRowClasses = settings.aoData[dataIndex].nTr.className.split(" ");
        console.log(myRowClasses);
        
        //alert(filter);
        if(filter == active || filter == "" || filter == "all")
        {
            return true;
        }
        
        
        return false;
     }
    );
//    
//        $.fn.dataTable.ext.search.push(
//        function( settings, data, dataIndex ) {
//       
//        var status = document.getElementById("activeStatusText").value
//        
//        var myRowClasses = settings.aoData[dataIndex].nTr.className.split(" ");
//        
//        console.log("status : " + status + ", class + " + myRowClasses);
//        if(status == "all")
//        {
//            return true;
//        }
//        if(myRowClasses.indexOf('gray-inactive') > -1 && status != 'active' && status.toString().toLowerCase() != 'active provider')
//        {
//            return true;
//        }
//        if(myRowClasses.indexOf('gray-inactive') < 0 && status == 'active')
//        {
//            return true;
//        }
//        return false;
//     }
//    );
        
        dataTableObj = $("#participantTable2").DataTable(
          {
          "sPaginationType": "full_numbers",
          "bDestroy": true,
          "iDisplayLength": 50
          });
          
                
        //$("#loading-div-background").css({ opacity: 1.0 });
        $("#certMessage").hide();
        //$("#pageHolder").show();
        dialogs = $( "#dialog-loading-message" ).dialog({
                                  autoOpen: false,
                                  modal: true,
                                  draggable: false,
                                  resizable: false,
                                      });  
        
    });
    
    
</script>
  <style type="text/css">
      div#dialog-loading-message {
    min-height: 50px !important;
}
#dialog-loading-message{
    display:none;
   }
#participantTable2 .gray-inactive {
    
    background-color: darkgray;
    color:#fff;
    
}
#participantTable2 .highlight-facility, #participantTable2 .highlight-facility .sorting_1  {
    
    background-color: #FFBABA !important;
}
 #participantTable2 .gray-inactive .sorting_1 {
    
    background-color: darkgray;
    color:#fff;
    
}
/*.ui-dialog-titlebar {
    display: none;
}
.no-close .ui-dialog-titlebar-close  {
  display: none;
}*/
  //////////////////////////////////
  // Jquery DataTable Custom Css //
  ////////////////////////////////
  
/*table.dataTable thead .sorting, 
    table.dataTable thead .sorting_asc, 
    table.dataTable thead .sorting_desc 
{
  background : none;
}

th 
{
    white-space: nowrap;
}

.sort-btn 
{
   margin:0 0 0 3px;
   font-size:10px;
   background-color:transparent;
   border:none;
   color:#fff;
}

#participantTable2 td {
    
    padding: 15px 15px 15px 3px;
   
}



.paginate_button {
    
    padding: 10px 10px;
    margin-left: 3px;
    cursor: pointer;
    
}

.paginate_button :hover {
    background-color: #66bf66;
    color: #fff;
}

 #participantTable2 .gray-inactive {
    
    background-color: darkgray;
    color:#fff;
    
}  

 #participantTable2 .gray-inactive .sorting_1 {
    
    background-color: darkgray;
    color:#fff;
    
}
#participantTable2 .highlight-facility, #participantTable2 .highlight-facility .sorting_1  {
    
    background-color: #FFBABA !important;
}*/

  </style>
  
 <script>
     function filterByActiveStatus()
     {
        var sel = document.getElementById("activeStatus");
        
        var activeStatus = document.getElementById("activeStatus").options[sel.selectedIndex].value;
        
        console.log("Status  = " + activeStatus);
        document.getElementById("activeStatusText").value = activeStatus;
        
        dataTableObj.draw();
     }
 </script>
</head>
    <input type="hidden" id="personInJurisdiction" value="<?php echo $this->personInJurisdiction; ?>" />
<input type="hidden" id="real_total_participants" value="<?php echo  $this->participants_count; ?>" />
<body class="yui-skin-sam" onload="hideRegion_c_id();">
    <div id="dialog-loading-message" title="" >
 
           <p style="text-align:center;v-align:middle;padding:10px !important" id="data">Fetching data...</p>
          </div>
    <div class="se-pre-con"></div>
<div id="pageHolder">
  <div id="header"><?php require_once('views/scripts/header.phtml');?></div>
  <div id="content" class="<?php if($this->mode != 'add') print 'edit-training' ?>">

  <h1><?php echo $this->pageTitle; ?></h1>
  <div id="certMessage">
    
  </div>
<?php if($this->certificationMessage) echo  '<div id="statusBox">' . $this->certificationMessage . '</div><br/>';?>
 
  <div id="saveT"></div>
  
  <?php if($this->mode != 'add') : ?>
 <?php if(!$this->viewonly ) : ?>
  <div  class="actionBtn" >
    <div class="clear yui-push-button">
      <button type="button" onclick="saveTraining();"><?php echo t('Save').' '.t('Training');?></button>
    </div></div>
  <?php endif; ?>

  <?php endif; ?>

  <?php if($this->msg) echo '<div class="errorText">' . $this->msg . '</div>'; ?>

  
<!-- "add new" training location pop-up modal -->

<div id="addLocation">
<div class="hd"><?php echo t('Add new').' '.t('Training').' '.t('Location');?></div>
<div class="bd">

    <h1><?php echo t('Please enter').' '.t('Training').' '.t('location').' '.t('information'.':');?></h1>
    <?php require_once('views/scripts/training/_template_locationform.phtml'); ?>

</div>
</div>


<script>

//TP: This is an ajax function that removes
//    a person from a training
function  removePersonFromTraining(personID, trainingID, colID)
{
    //e.preventDefault();
    var c = confirm("Are you sure you want to delete " + personID + " from training? ");
    console.log(colID);
    if(c)
    {
        <?php echo 'var postUrl = "'. $this->base_url . '/training/removePersonFromTraining";'; ?>
        console.log(postUrl);
        $.ajax(
                {
                    type:'POST',
                    data:"person_id="+personID+"&training_id="+trainingID,
                    url: postUrl,
                    beforeSend: function() {
                       $("#dialog-loading-message .ui-dialog").show();
                       document.getElementById("dialog-loading-message").style.display = "block";
                       document.getElementById("data").innerHTML = "Deleting...";
                       $('.ui-dialog-titlebar').hide();
                       dialogCert = $( "#dialog-loading-message" ).dialog();
                       $('#dialog-loading-message').dialog('open');

                        /*   dialogCert = $( "#dialog-loading-message" ).dialog();
                       $('#dialog-loading-message').dialog('close');
                     $('.ui-dialog-titlebar').show();
                     document.getElementById("data").innerHTML = "Deleting...";
                      */
                    },
                    success: function(res)
                    {
                        if(res)
                        {
                            
                              dataTableObj.row($("#" + colID.id).parent("tr")).remove().draw();
                              
                              //$("#" + colID.id).parent("tr").css("display","none");
                              
                              dialogCert = $( "#dialog-loading-message" ).dialog();
                              $('#dialog-loading-message').dialog('close');
                             $('.ui-dialog-titlebar').show();
                             document.getElementById("data").innerHTML = "Deleting...";
                            // document.getElementById(colID).style.background-color = "red";
                            
                            
                            var participants = $("#participantTable2 tbody tr.tp-row");
                            
                            $("#updateParticipantCount").val(participants.length);
                            
                            console.log(participants.length);
                        }
                        else
                        {
                            alert("Ooops something went wrong")
                        }
                    },
                    error: function(jqXHR, textStatus, errorThrown)
                    {
                        console.log("something went wrong, " + textStatus + " - " + errorThrown);
                    }
                })
    }
    
    
}

YAHOO.namespace("example.container");

function hideRegion_c_id(){
                    document.getElementById("region_c_id").style.display = "none";
                    document.getElementById("region_c_id").style.visibility = "hidden";
                    
                    document.getElementById("region_c_lbl").style.display = "none";
                    document.getElementById("region_c_lbl").style.visibility = "hidden";
                    
                    document.getElementById("showregionc_id").style.display = "none";
                    document.getElementById("showregionc_id").style.visibility = "hidden";
                    
                    
                    }
                    
//add end date handler
function dateCalc() {
    var elSD = YAHOO.util.Dom.get("start-day").value;
    var elSM = YAHOO.util.Dom.get("start-month").value;
    var elSY = YAHOO.util.Dom.get("start-year").value;
    var elED = YAHOO.util.Dom.get("end-day").value;
    var elEM = YAHOO.util.Dom.get("end-month").value;
    var elEY = YAHOO.util.Dom.get("end-year").value;
    if (elSM > 0) elSM--;
    if (elEM > 0) elEM--;
    var startTime = new Date(elSY, elSM, elSD,1).getTime();
    var endTime = new Date(elEY, elEM, elED,1).getTime();
    var day = 1000*60*60*24;
    var duration = (endTime - startTime)/day;
    if ( duration >= 0 && duration < 1200) {
      YAHOO.util.Dom.get("training_length_value").value = Math.round(duration) + 1;
        YAHOO.util.Dom.get("interval2").checked = 'checked';

    }
  }

function dateConfirm() {
    var elSD = YAHOO.util.Dom.get("start-day").value;
    var elSM = YAHOO.util.Dom.get("start-month").value;
    var elSY = YAHOO.util.Dom.get("start-year").value;
    var elED = YAHOO.util.Dom.get("end-day").value;
    var elEM = YAHOO.util.Dom.get("end-month").value;
    var elEY = YAHOO.util.Dom.get("end-year").value;
    if (elSM > 0) elSM--;
    if (elEM > 0) elEM--;
    var startTime = new Date(elSY, elSM, elSD,1).getTime();
    var endTime = new Date(elEY, elEM, elED,1).getTime();
    var day = 1000*60*60*24;
    var duration = (endTime - startTime)/day;
      if ( YAHOO.util.Dom.get("training_length_value").value != (Math.round(duration) + 1) )
      alert("<?php echo t('It looks like the').' '.t('training').' '.t('dates do not match the length. Please double check these fields.');?>");

  }

function init() {

	// Define various event handlers for Dialog
	var handleSubmit = function() {
		//clear error text
		var els = YAHOO.util.Dom.getElementsByClassName('errorText');
		if ( els.length )
			YAHOO.util.Dom.setStyle(els, 'display', 'none');
		this.submit();
	};
	var handleCancel = function() {
		this.cancel();
	};
	var handleSuccess = function(o) {
		var response = o.responseText;
		var responseObj = YAHOO.lang.JSON.parse(response);
		displayStatus(responseObj.status);
		var allGood = true;
		if ( responseObj.messages ) {
			for (var key in responseObj.messages) {
				YAHOO.example.container.addLocation.show();
				displayErrorMessage(key,responseObj.messages[key]);
				allGood = false;
			}
		}

		if ( allGood ) {
		  var locationNameEl = YAHOO.util.Dom.get('locationName');
		  var oSelect = YAHOO.util.Dom.get('select_training_location');

      var addIndex = oSelect.options.length;
      oSelect.options[addIndex] = new Option(locationNameEl.value, responseObj.location_id);
      oSelect.selectedIndex = addIndex;
		}

	};
	var handleFailure = function(o) {
		alert("Submission failed: " + o.status);
	};

	// Instantiate the Dialog
	YAHOO.example.container.addLocation = new YAHOO.widget.Dialog("addLocation",
							{ width : "650px",
							  fixedcenter : true,
							  visible : false,
							  constraintoviewport : true,
							  modal : true,
							  zIndex: 9100,
							  context : ["trainingForm", "tl", "bl"],
							  buttons : [ { text:"<?php tp('Submit');?>", handler:handleSubmit, isDefault:true },
								      { text:"<?php tp('Cancel');?>", handler:handleCancel } ]
							});


// Instantiate the Dialog
	YAHOO.example.container.editCertification = new YAHOO.widget.Dialog("editCertification",
							{ width : "650px",
							  fixedcenter : true,
							  visible : false,
							  constraintoviewport : true,
							  modal : true,
							  zIndex: 9100,
							  context : ["editCertification", "tl", "bl"],
							  buttons : [ { text:"<?php tp('Submit');?>", handler:handleSubmit, isDefault:true },
								      { text:"<?php tp('Cancel');?>", handler:handleCancel } ]
							});
	// Validate the entries in the form to require that both first and last name are entered
	YAHOO.example.container.addLocation.validate = function() {
		return true;//do all validation server side
	};

	// Wire up the success and failure handlers
	YAHOO.example.container.addLocation.callback = { success: handleSuccess,
						     failure: handleFailure };

	// Render the Dialog
	YAHOO.example.container.addLocation.render();

	YAHOO.util.Event.addListener("show", "click", YAHOO.example.container.addLocation.show, YAHOO.example.container.addLocation, true);

YAHOO.util.Event.addListener("shows", "click", YAHOO.example.container.editCertification.show, YAHOO.example.container.editCertification, true);
	   YAHOO.util.Event.addListener("end-day", "change", dateCalc);
	   YAHOO.util.Event.addListener("end-month", "change", dateCalc);
	   YAHOO.util.Event.addListener("end-year", "change", dateCalc);

	   YAHOO.util.Event.addListener("training_length_value", "change", dateConfirm);
}
YAHOO.util.Event.onDOMReady(init);



</script>
<script>
  
  $(function() {
     
    var dialog, form,
 
          
      tips = $( ".validateTips" );
 
    
 
    function addUser() {
      return true;
    }
 
    dialog = $( "#dialog-form" ).dialog({
      autoOpen: false,
      height: 300,
      width: 350,
      modal: true,
      buttons: {
        
        Cancel: function() {
            console.log("Closing certification dialog");
          dialog.dialog( "close" );
          
        }
      },
      close: function() {
        $("#editCertificationForm")[0].reset();
       
      }
    });
 
 dialogs = $( "#dialog-certification-message" ).dialog({
      autoOpen: false,
      modal: true,
     
    
    });
   
 
  });
 
  function popup(personToTrainingId,certify,unique){
     // var bid = this.id; // button ID 
       var row = $(unique).parents('tr').attr('id');
        var column = $(unique).parents('td').attr('id');
        var content = document.getElementById(""+column+"").innerHTML;
      
    
      var personToTrainingId = personToTrainingId;
      var certificationValue = certify.toLowerCase();
      if(certificationValue=="n" || certificationValue=="no" ){
          document.getElementById("certifyNo").selected = "selected";
      }else if(certificationValue=="y" || certificationValue=="yes"){
           document.getElementById("certifyYes").selected = "selected";
      }
      //alert(certificationValue);
     // alert(personToTrainingId);
    document.getElementById("personToTrainingIdForm").setAttribute('value',personToTrainingId);
    document.getElementById("columnId").setAttribute('value',column);
    //alert(document.getElementById("personToTrainingForm").value);
     $("input#personToTrainingIdForm").hide();
     document.getElementById("personToTrainingIdForm").visibility = "hidden";
     document.getElementById("personToTrainingIdForm").display = "none";
     $("input#columnId").hide();
     document.getElementById("columnId").visibility = "hidden";
     document.getElementById("columnId").display = "none";
     dialog = $( "#dialog-form" ).dialog();
      /*dialog = $( "#dialog-form" ).dialog({
      autoOpen: false,
      height: 300,
      width: 350,
      modal: true,
      buttons: {
        "Update Certification": addUser,
        Cancel: function() {
          dialog.dialog( "close" );
        }
      },
      close: function() {
        form[ 0 ].reset();
       
      }
    });*/
    /*
    form = dialog.find( "form" ).on( "submit", function( event ) {
      event.preventDefault();
      addUser();
    });*/
 
      
      dialog.dialog( "open" );
  
    
      return false;
  }
  </script>

<script>
  

$(function() {

    //this submits a form
$('#submitCert').click(function() {
    //alert('This is where the form is ')
    
        $.ajax({
            type: "POST",
            url: "<?php echo $this->base_url;?>/training/editcertification",
            data: $("#editCertificationForm").serialize(),
            beforeSend: function() {
                  
               
              // alert("It is working");
              $('.ui-dialog-titlebar').hide();
               dialogCert = $( "#dialog-certification-message" ).dialog();
               //alert("It is working2");
               //$('#dialog-form').dialog('close');
              // alert("It is working3");
               $('#dialog-certification-message').dialog('open');
               
               
                //$('#result').html('<img src="loading.gif" />');
                //ShowProgressAnimation();
                //alert("What is going on");
            },
            success: function(data) {
                
             var responseData =   jQuery.parseJSON(data);
             var certification = responseData.certification;
             var columnId = responseData.columnId;
             var pttId = responseData.pttId;
             var editContentValue = "<div class='yui-dt-col-certification yui-dt-col-14 yui-dt-liner yui-dt-resizeable'>"+certification+"&nbsp;&nbsp;<a href='' id='editcertificationbutton' onclick='popup(\""+pttId+"\",\""+certification+"\",this);return false;'>Edit</a></div>";
             var status = responseData.status;
             if(status){
               var msg = "Participant's certification successfully updated";  
             }else{
               var msg = "Participant's certification not updated, because certification is still the same";
             }
             
             
             document.getElementById("certMessage").innerHTML = "<div id='statusBox'>"+msg+"</div>";
             $('#certMessage').show().fadeIn('slow');
             
             document.getElementById(""+columnId+"").innerHTML = editContentValue;
             
             dialogCert = $( "#dialog-certification-message" ).dialog();
             
             dialogCert.dialog("close");
             $('.ui-dialog-titlebar').show();
                //alert("This is successful");
                //$("#loading-div-background").hide();
                //alert(data);
            },
            error: function(jqXHR, textStatus, errorThrown){
              console.log(" The following error occured: "+ textStatus, errorThrown );
              alert(" The following error occured: "+ textStatus+" "+ errorThrown);
            }

        })
    });
    
    
    
});

function saveTraining(){
<?php if ( $this->mode != 'add') {
      echo 'var postUrl = "'. $this->base_url . '/training/edit/id/'.$this->row['id'].'";';
      echo 'var mode = "edit";';
} else {
      echo 'var postUrl = "' . $this->base_url . '/training/add/";';
      echo 'var mode = "add";';
} ?>
$(function() {
               $.ajax({
            type: "POST",
            url: postUrl,
            data: $("#trainingForm").serialize(),
            beforeSend: function() {
                
                $("#dialog-loading-message .ui-dialog").show();
               document.getElementById("dialog-loading-message").style.display = "block";
               if(mode=="add"){
                   document.getElementById("data").innerHTML = "Creating Training...";
               }else{
                   document.getElementById("data").innerHTML = "Updating Training...";
               }
               
              
                 
             $('.ui-dialog-titlebar').hide();
               dialogCert = $( "#dialog-loading-message" ).dialog();
               $('#dialog-loading-message').dialog('open');
               
                /*   dialogCert = $( "#dialog-loading-message" ).dialog();
               $('#dialog-loading-message').dialog('close');
             $('.ui-dialog-titlebar').show();
             document.getElementById("data").innerHTML = "Deleting...";
              */
            },
            success: function(data) {
               // alert(data);
                var els = YAHOO.util.Dom.getElementsByClassName('errorText');
        if ( els.length )
          YAHOO.util.Dom.setStyle(els, 'display', 'none');
      //alert(data);
                var responseObj = jQuery.parseJSON(data);
        //alert(responseObj);
        //$(".errorText").innerHTML = "";
       displayStatus(responseObj.status);
        var allGood = true;
        if ( responseObj.messages ) {
          for (var key in responseObj.messages) {
            displayErrorMessage(key,responseObj.messages[key]);
            allGood = false;
          }
        }
        if(!allGood) {
          setStatusBoxError();
        }
              /* dialogCert = $( "#dialog-loading-message" ).dialog();
               $('#dialog-loading-message').dialog('close');
             $('.ui-dialog-titlebar').show();
             document.getElementById("data").innerHTML = "Saving Training...";
       */
        if ( responseObj.obj_id ) {
          var new_obj_field =  YAHOO.util.Dom.get('obj_id');
          if ( new_obj_field ) {
            new_obj_field.value = responseObj.obj_id;
          }
        }
        
               // alert(responseObj.redirect);
                //alert(allGood);
                var redir = document.getElementById('redirectUrl');
        if(redir.value != '' && allGood){
          //  alert("This is the redirect url"+redir.value+"this is it");
          window.location =  redir.value;
        } else if ( responseObj.redirect ) {
           // alert("this is the link to run to "+responseObj.redirect);
          window.location = responseObj.redirect;
        }
              
               dialogCert = $( "#dialog-loading-message" ).dialog();
               $('#dialog-loading-message').dialog('close');
             $('.ui-dialog-titlebar').show();
             document.getElementById("data").innerHTML = "Saving Training...";
               
            },
            error: function(jqXHR, textStatus, errorThrown){
              console.log(" The following error occured: "+ textStatus, errorThrown );
              alert(" The following error occured: "+ textStatus+" "+ errorThrown);
              
              dialogCert = $( "#dialog-loading-message" ).dialog();
               $('#dialog-loading-message').dialog('close');
             $('.ui-dialog-titlebar').show();
             document.getElementById("data").innerHTML = "Deleting...";
            }

        })
  
    
    
    
});
}

function deleteForms() {
   //$this->base_url;?>    
$(function() {
               $.ajax({
            type: "POST",
            url: "<?php echo $this->base_url;?>/training/deletetraining",
            data: $("#trainingForm").serialize(),
            beforeSend: function() {
                
                $("#dialog-loading-message .ui-dialog").show();
               document.getElementById("dialog-loading-message").style.display = "block";
               document.getElementById("data").innerHTML = "Deleting...";
              
                 
             $('.ui-dialog-titlebar').hide();
               dialogCert = $( "#dialog-loading-message" ).dialog();
               $('#dialog-loading-message').dialog('open');
               
                /*   dialogCert = $( "#dialog-loading-message" ).dialog();
               $('#dialog-loading-message').dialog('close');
             $('.ui-dialog-titlebar').show();
             document.getElementById("data").innerHTML = "Deleting...";
              */
            },
            success: function(data) {
                if(data=="true"){
                    window.location = "<?php echo $this->base_url;?>/training/deleted";
                }else{
                    alert(data);
                }
                
             document.getElementById("data").innerHTML = "Deleting...";
              //alert("this is the success "+data);
              
               
            },
            error: function(jqXHR, textStatus, errorThrown){
              console.log(" The following error occured: "+ textStatus, errorThrown );
              alert(" The following error occured: "+ textStatus+" "+ errorThrown);
              
              dialogCert = $( "#dialog-loading-message" ).dialog();
               $('#dialog-loading-message').dialog('close');
             $('.ui-dialog-titlebar').show();
             document.getElementById("data").innerHTML = "Deleting...";
            }

        })
  
    
    
    
});

 /*var buttonId = 'submitTraining';
  var formId = 'trainingForm';
  <?php
   // echo 'var postUrl = "'. $this->base_url . '/training/edit/id/'.$this->row['id'].'/outputType/json/specialAction/delete"';
?>
    $(function() {
    alert('This is where the form is ')
    
        $.ajax({
            type: "POST",
            url: postUrl,
            data: $("#trainingForm").serialize(),
            beforeSend: function() {
                  
              alert("this is before the data goes down there");
            },
            success: function(data) {
                
             var responseData =   jQuery.parseJSON(data);
             alert(responseData);
            },
            error: function(jqXHR, textStatus, errorThrown){
              console.log(" The following error occured: "+ textStatus, errorThrown );
              alert(" The following error occured: "+ textStatus+" "+ errorThrown);
            }

        })
  
    
    
    
});
*/
}
</script>
<style type="text/css">
    .ui-widget-header{
        color:white !important;
        background:green !important;
    }
</style>
<div id="dialog-form" title="Edit Certification">
 
 
  <form action="" method="post" id="editCertificationForm" onSubmit="return false;"> 
    <fieldset>
      <label for="name">Select Certification</label><br/><br/>
      <input type="text" name="personToTrainingId" value="" id="personToTrainingIdForm" />
      <input type="text" name="columnIdForm" value="" id="columnId" /><br/>
      <select name="certification" id="certificationPopUp"  class="">
          <option value="Y" id="certifyYes">Yes</option>
          <option value="N" id="certifyNo">No</option>
      </select>
      <br/><br/>
      
            <div class="clear yui-push-button">
      <p align="center"><button style="margin: 0 auto;" type="submit" name="submitcertificationForm" id="submitCert" class="" value="Update" align="center" onclick="$( '#dialog-form' ).dialog('close');">Update</button></p>
      <!-- Allow form submission with keyboard without duplicating the dialog button -->
        
        </div>
    </fieldset>
  </form>
</div>
<div id="dialog-certification-message" title="" style="max-height:52px !important;">
 
 <p style="text-align:center;v-align:middle;padding-top:45px !important">Updating...</p>
</div>

<div>
  <form name="trainingForm" id="trainingForm" method="post">
     <input type="hidden" name="redirectUrl" id="redirectUrl" value=""/>
 <?php if($this->mode != 'add') : ?>

  <!-- history + links -->
  <div class="historyDiv">
    <b><?php tp('ID');?></b> <?php echo $this->row['id']; ?><br/><b><?php tp('Date created:');?></b> <?php echo $this->row['timestamp_created']; ?><br>
    <b><?php tp('Created by:');?></b> <?php echo $this->row['creator']; ?><br>
    <b><?php tp('Date modified:');?></b>  <?php echo $this->row['timestamp_updated']; ?><br>
    <b><?php tp('Modified by:');?></b> <?php echo $this->row['updater']; ?><br>
    <hr size="1">
    <a href="javascript:submitThenRedirect('<?php echo $this->base_url;?>/training/roster/id/<?php echo $this->row['id']; ?>');" onclick=""><?php echo t('View/Print Training Roster');?></a><br>
    <?php if ( $this->setting['module_evaluation_enabled'] ) { ?>
    <?php if ( !@$this->evaluation_id ) { ?><a href="javascript:submitThenRedirect('<?php echo $this->base_url;?>/evaluation/assign-training/id/<?php echo $this->row['id']; ?>');" onclick=""><?php echo t('Assign Evaluation to').' '.t('Training');?></a>&nbsp;&nbsp;&nbsp;<?php } ?>
    <?php if ( @$this->evaluation_id ) : ?><a href="javascript:submitThenRedirect('<?php echo $this->base_url;?>/evaluation/data/id/<?php echo $this->evaluation_to_training_id; ?>');" onclick=""><?php tp('Enter Evaluation Data');?></a>&nbsp;&nbsp;&nbsp;<a href="javascript:submitThenRedirect('<?php echo $this->base_url;?>/reports/evaluations/training_id/<?php echo $this->row['id']; ?>');" onclick=""><?php tp('View Data');?></a>&nbsp;&nbsp;&nbsp;<a href="javascript:submitThenRedirect('<?php echo $this->base_url;?>/reports/evaluations/training_id/<?php echo $this->row['id']; ?>/outputType/csv');" onclick=""><?php tp('Export');?></a><?php else : ?><?php tp('unassigned')?><?php endif;?><br>
    <?php } ?>
    <?php if(!$this->viewonly) : ?>
      <?php if ($this->hasACL('duplicate_training')) { echo '  <a href="" onclick="duplicateTraining(); return false;">'.t('Duplicate this').' '.t('Training').'</a><br>'; } ?>
      <a href="#" onclick="deleteTraining(); return false;"><?php echo t('Delete this').' '.t('Training');?></a>
    <?php endif; ?>

  </div>
<?php endif; ?>
<!-- TA:17: 8/27/2014 START-->
<?php if($this->setting['display_training_category']){
echo "<div class='fieldIndentNoMargin'>&nbsp;</div><br/>";
echo "<div class='fieldLabel' id='training_category_id_lbl'>" . $this->translation['Training Category'] . "</div>";
echo "<div class='fieldInput'  >";
echo @$this->dropDownCategory;
echo "</div>";
}else{
echo "<br clear='top'/><br clear='left'/><br clear='top'/>";
}?>
<!-- TA:17: 8/27/2014 END -->
	
  <div class="fieldLabel" id="training_title_lbl"><span class="required">*</span><?php echo $this->translation['Training Name']; ?></div>
  <div class="fieldInput" >
  
        <select id="select_training_title_option" name="training_category_and_title_option_id">
    <option value="">&mdash; <?php tp('select');?> &mdash;</option>
		<?php
      $lastId = NULL;
      foreach ( $this->categoryTitle as $vals ) {
        $isSelected = ($vals['id'] && $vals['id'] === $this->row['training_title_option_id']) ? ' selected="selected"' : '';

        // Also list empty prefix to allow all titles to be displayed
        if($vals['training_category_option_id'] && $vals['id'] != $lastId) {
          echo '<option value="_'.$vals['id'].'">'.$vals['training_title_phrase'].'</option>';
        }

        echo '<option value="'.$vals['training_category_option_id'].'_'.$vals['id'].'"'.$isSelected.'>'.$vals['training_title_phrase'].'</option>';
        $lastId = $vals['id'];
      }
		?>
		</select>
                        <?php print $this->titleInsertLink; ?>    
                        <?php echo hasACLEdit('acl_editor_training_title', 'admin/training-title', $this); ?>
                   
  
  </div>

    <script>
    // Set correct title
    elCategory = YAHOO.util.Dom.get("select_training_category_option");
    elTitle = YAHOO.util.Dom.get("select_training_title_option");
    elCategory.onchange = function() { setTrainingTitle(this.selectedIndex,'select_training_category_option','select_training_title_option'); }
    setTrainingTitle(elCategory.selectedIndex,'select_training_category_option','select_training_title_option');

    // Select title if editing
    training_title_id = "<?php print $this->row['training_title_option_id'];?>";
    if(training_title_id) {
      for(var i = 0; i < elTitle.options.length; i++) {
        if(elTitle.options[i].value == elCategory.options[elCategory.selectedIndex].value + "_" + training_title_id){
          elTitle.options[i].selected = true;
        }
      }
    }
    
  
    <?php if($this->viewonly) print 'elTitle.disabled = true'; ?>

    <?php if(!$this->row['id']) { ?>
    elTitle.selectedIndex = 0; //  do not default to "unknown" title
    <?php } ?>

    </script>

<!-- TA:17: 09/02/2014  -->
<?php if($this->setting['display_training_start_date']){?>
  <div class="fieldLabel"><?php echo t('Training').' '.t('Date Range');?></div>
  <div class="fieldInput" id="startdate">
    <?php tp('Day');?> <input id="start-day" class="dayfield" type="text" name="start-day" maxlength="2" value="<?php echo $this->row['start-day']; ?>"<?php echo $this->viewonly; ?>>
    / <?php tp('Month');?> <input id="start-month" class="monthfield" type="text" name="start-month" maxlength="2" value="<?php echo $this->row['start-month']; ?>" <?php echo $this->viewonly; ?>>
    / <?php tp('Year');?> <input id="start-year" class="yearfield" type="text" name="start-year" maxlength="4" value="<?php if(!empty($this->row['start-year']) && $this->row['start-year'] != '0000') echo $this->row['start-year'];  ?>" <?php echo $this->viewonly; ?>>

    <?php if(!$this->viewonly) : ?>
      <script  type="text/javascript">
  		    YAHOO.util.Event.onDOMReady(function () {
  		    	makeCalendar("startdate","start-day", "start-month", "start-year",dateCalc);
  		    });
  		</script>
    <?php endif; ?>
  </div><br/>
   <?php } ?>
   
<?php if ( $this->setting['display_end_date'] ) { ?>
 <div class="fieldLabel"><span class="required">*</span></div>
 <div class="fieldInput" id="enddate">
    <?php tp('Day');?> <input id="end-day" class="dayfield" type="text" name="end-day" maxlength="2" value="<?php echo $this->row['end-day']; ?>"  <?php echo $this->viewonly; ?> >
    / <?php tp('Month');?> <input id="end-month" class="monthfield" type="text" name="end-month" maxlength="2" value="<?php echo $this->row['end-month']; ?>"  <?php echo $this->viewonly; ?>  >
    / <?php tp('Year');?> <input id="end-year" class="yearfield" type="text" name="end-year"  maxlength="4" value="<?php if(!empty($this->row['end-year']) && $this->row['end-year'] != '0000') echo $this->row['end-year']; else echo date('Y'); ?>"  <?php echo $this->viewonly; ?>>

    <?php if(!$this->viewonly) : ?>
      <script  type="text/javascript">
  		    YAHOO.util.Event.onDOMReady(function () {
  		    	makeAdditionalCalendar("enddate","end-day", "end-month", "end-year",dateCalc);
  		    });
  		</script>
    <?php endif; ?>
  </div><br/>
  <?php } ?>

  <!-- TA:17: 09/03/2014 START-->
<?php if($this->setting['display_training_length']){?>
  <div class="fieldLabel" id="training_length_value_lbl"><?php echo t('Training').' '.t('length');?></div>
  <div class="fieldInput">
    <input type="text" id="training_length_value" name="training_length_value" size="6" value="<?php echo $this->row['training_length_value']; ?>" <?php echo $this->viewonly; ?>>
    &nbsp;
    <input type="radio" name="training_length_interval" value="hour" id="interval1" <?php if($this->row['training_length_interval'] == 'hour') echo 'checked'; ?> <?php echo $this->viewonly; ?>>
    <label for="interval1"><?php tp('hours');?></label>
    &nbsp;
    <input type="radio" name="training_length_interval" value="day" id="interval2" <?php if($this->row['training_length_interval'] == 'day') echo 'checked'; ?> <?php echo $this->viewonly; ?>>
    <label for="interval2"><?php tp('days');?></label>
    &nbsp;
    <input type="radio" name="training_length_interval" value="week" id="interval3" <?php if($this->row['training_length_interval'] == 'week') echo 'checked'; ?> <?php echo $this->viewonly; ?>>
    <label for="interval3"><?php tp('weeks');?></label>
    <span id="training_length_interval_lbl"></span>
  </div><br/>
  <?php }?>

  <div class="fieldLabel" id="training_organizer_option_id_lbl"><?php echo $this->translation['Partner']; ?></div>
  <div class="fieldInput">
    <?php echo $this->dropDownOrg; ?>
    <?php echo hasACLEdit('acl_editor_training_organizer', 'admin/training-organizer', $this); ?>
  </div><br/>
  
  <!-- TA:17:14: -->
  <?php if($this->setting['display_training_location']){?>
  <div class="fieldLabel" id="training_location_id_lbl"><span class="required">*</span><?php echo t('Training').' '.t('Location');?></div>
  <div class="fieldInput">
    <?php
      training_location_dropdown ($this->tlocations, $this->row['training_location_id'], 'name="training_location_id" id="select_training_location" '.$this->viewonly);
      if(!$this->viewonly)
         echo $this->insertLocationLink;
    ?>
  </div><br/>

  <?php }?>

  
  
  <!-- TA:17: 09/03/2014 -->
  <?php if($this->setting['display_training_level']){?>
  <div class="fieldLabel" id="training_level_option_id_lbl"><span class="required">*</span><?php echo $this->translation['Training Level']; ?></div>
  <div class="fieldInput"><select name="training_level_option_id" id="training_level_option_id"  <?php echo $this->viewonly; ?>>
          <option value="">--choose--</option>
    <?php
     foreach($this->trainingLevel as $tLevel){
         $id= $tLevel['id'];
         $selected = "";
         if($id==$this->row['training_level_option_id']){
             $selected = "selected";
         }
         $tlName = $tLevel['level_title'];
         echo "<option value='".$id."' ".$selected.">".$tlName."</option>";
     }
    ?>
      </select>
  </div><br/>
<!--  <div class="fieldLabel" id="training_level_option_id_lbl"><?php //echo $this->translation['Training Level']; ?></div>
  <div class="fieldInput">
    <?php //echo $this->dropDownLevel; ?>
    <?php

      #if(!@$this->setting['desktop_disable_insert_level']) {    // desktop_disable_ prefix is only in tanzania databases, but anyone can add this option to their _system
        //echo hasACLEdit('acl_editor_training_level', 'admin/training-level', $this);
     # }
    ?>
  </div><br/>-->
  <?php }?>

    <?php if($this->mode == 'add' && $this->setting['module_unknown_participants_enabled']) :  ?>
	 <div class="fieldLabel" id="training_has_known_participants"><?php tp('Participants are known'); ?></div>
	  <div class="fieldInput">
		<input type="checkbox" name="has_known_participants" value="1" id="has_known_participants" checked />
	  </div>
    <?php endif; ?>


  <?php
  /*** ADD TRAINING ends here ***************************************************************************/
  if($this->mode == 'add') : ?>
         
    <div class="clear"></div>
    <?php if( $this->hasACL('edit_course') ) : ?>
    <!-- import training button -->
    
    <span id="importTraining" class="yui-button yui-push-button" style="float:left;">
      <span class="first-child">
        <button onclick="location.href='<?php echo $this->base_url; ?>/training/import';return false;" type="button" tabindex=1 id="trainingImportBtn" class="yui-button yui-push-button"><?php tp('Import trainings from Excel');?></button>
      </span>
    </span>
    
    <?php endif; ?>
    
    <button type="button" id="submitTraining" onclick="saveTraining();"><?php tp('Save and Continue');?></button><br>
<script type="text/javascript">
 $(function() {
$('#submitTraining').click(function() {
   saveTraining();
});
 }
</script>
        
    <script>
    //addAjaxSubmit('submitTraining','trainingForm','<?php echo $this->base_url;?>/training/add/outputType/json');
    </script>
    </form></div>

    </div>
    <div id="footer"><?php require_once('views/scripts/footer.phtml');?></div>
    </body>
    </html>

  <?php return; endif;?>
  <?php if($this->setting['display_training_pepfar']) :  ?>
  <div class="fieldLabel" id="training_pepfar_categories_option_lbl"><?php echo $this->translation['PEPFAR Category']; ?></div>
  <div class="fieldInput"><div style="margin-left: 250px;">
    <?php for($j = 0; $j < $this->NUM_PEPFAR; $j++) { ?>

      <?php echo $this->dropDownPepfars[$j]; ?>

      <?php if($this->NUM_PEPFAR != 1) : ?>
        <input name="pepfar_days[]" type="text" size="3" value="<?php if(isset($this->pepfarDurations[$j]) && $this->pepfarDurations[$j]) echo $this->pepfarDurations[$j] . '';?>" <?php echo $this->viewonly; ?>> <?php tp('days');?>
      <?php endif; ?>

      <?php if($j != $this->NUM_PEPFAR - 1) echo '<br/><br/>'; ?>

    <?php } ?>

  </div></div><br/>
  <?php endif; ?>
  <?php if ($this->setting['display_training_method'] ) { ?>
    <div class="fieldLabel" id="training_method_option_id_lbl"><?php echo $this->translation['Training Method']; ?></div>
  <div class="fieldInput">
    <?php echo $this->dropDownMethod; ?>
    <?php echo hasACLEdit('acl_editor_method', 'admin/training-method', $this); ?>
  </div>
  <?php } ?>

  <?php if($this->setting['display_training_topic']) : ?>
  <div class="fieldLabel" id="training_topic_option_id_lbl"><?php echo (@$this->translation['Training Topic']); ?></div>
  <div class="fieldInput" id="topicContainer">
    <?php if(isset($this->dropDownTopic)) : ?>
      <?php echo $this->dropDownTopic; ?>
    <?php elseif($this->topicArray) : ?>
      <div style="line-height:1.5em;margin-bottom:0.5em;">
       <?php if(!$this->viewonly) : ?>
          <?php tp('Check all that apply below');?>
          <?php echo $this->insertTopicLink; ?>
          <?php echo hasACLEdit('acl_editor_training_topic', 'admin/training-topic', $this); ?>
        <?php endif; ?>
      </div>
      <?php
        // table used to align checkboxes w/labels
        $topicChunked = array_chunk($this->topicArray, count($this->topicArray) / 2);

        foreach($topicChunked as $i => $topicRay) {
          if ( $i%2 == 0) echo '<div class="fieldLabel" >&nbsp;</div>';
          echo '<div class="float50" style="width: 33%;"><table width="100%" class="tableChoices">';
          foreach($topicRay as $item) {
            $isChecked = (isset($item['training_id']) && $item['training_id']) ? ' checked' : '';
            echo '<tr><td valign="top" width="30px;">';
            echo '<input type="checkbox" name="topic_id[]" value="'.$item['id'].'" id="topic_id_'.$item['id'].'"'.$isChecked.' '.$this->viewonly.'> ';
            echo '</td><td valign="top">';
            echo '<label for="topic_id_'.$item['id'].'">'.$item['training_topic_phrase'].'</label>';
            echo '</td></tr>';
          }
          echo '</table></div>';
        }

      ?>
      </tr>
      </table>
    <?php endif; ?>
  </div><br/><br clear="all"/>
  <?php endif; ?>

  <?php if($this->setting['display_training_trainers']) : ?>
  <div class="fieldLabel"><?php echo $this->translation['Training of Trainers'];?></div>
  <div class="fieldInput" id="totContainer">
    <input type="checkbox" name="is_tot" value="1" id="is_tot" <?php if($this->row['is_tot']) print 'checked'; ?>/><label for="is_tot"></label>
  </div><br/>
  <?php endif; ?>

  <?php if($this->setting['display_training_refresher']) : ?>
  <div class="fieldLabel"><?php echo $this->translation['Refresher Course'];?></div>
  <div class="fieldInput" id="refresherContainer">
  	<?php

  	if(@$this->setting['multi_opt_refresher_course']) {
  		echo '<div style="line-height:1.5em;margin-bottom:0.5em;">';
  		if(!$this->viewonly) {
  			tp('Check all that apply below');
  			echo $this->refresherInsertLink;
        echo hasACLEdit('acl_editor_refresher_course', 'admin/training-refreshercourse', $this);
  		}
  		echo '</div>';
  		if($this->refresherArray) {
			// table used to align checkboxes w/labels
  			$chunked = array_chunk($this->refresherArray, count($this->refresherArray) / 2);

  			foreach($chunked as $i => $topicRay) {
  				if ( $i%2 == 0) echo '<div class="fieldLabel" >&nbsp;</div>';
  				echo '<div id="refresherTableContainer" class="float50" style="width: 33%;"><table width="100%" class="tableChoices">';
  				foreach($topicRay as $item) {
  					$isChecked = (isset($item['training_id']) && $item['training_id']) ? ' checked' : '';
  					echo '<tr><td valign="top" width="30px;">';
  					echo '<input type="checkbox" name="training_refresher_option_id[]" value="'.$item['id'].'" id="training_refresher_option_id_'.$item['id'].'"'.$isChecked.' '.$this->viewonly.'> ';
  					echo '</td><td valign="top">';
  					echo '<label for="refresher_id_'.$item['id'].'">'.$item['refresher_phrase_option'].'</label>';
  					echo '</td></tr>';
  				}
  				echo '</table></div>';
  			}
  			echo '</tr>';
  			echo '</table>';
  		}

  	} else {
        echo '  <input type="checkbox" name="is_refresher" value="1" id="is_refresher" ';
        if($this->row['is_refresher']){ echo 'checked'; }
        echo '><label for="is_refresher"></label>';
    }
    ?>
  </div><br/><br clear="all"/>

  <?php endif; ?>

  <script  type="text/javascript">
  function updateTrainingCheck(parent_check, funding_amount) {
	   if ( YAHOO.util.Dom.get(funding_amount).value ) {
		   YAHOO.util.Dom.get(parent_check).checked = "checked";
		 }
	}
  </script>

  <?php if($this->setting['display_funding_options']) : ?>

  <div class="fieldLabel"><?php tp('Funding');?></div>
  <div class="fieldInput" id="fundingContainer">
    <div style="line-height:1.5em;margin-bottom:0.5em;">
     <?php if(!$this->viewonly) : ?>
        <?php tp('Check all that apply below');?>
        <?php echo $this->fundingInsertLink; ?>
        <?php echo hasACLEdit('acl_editor_funding', 'admin/training-funding', $this); ?>
      <?php endif; ?>
    </div>
    <?php
      // table used to align checkboxes w/labels
      $fundingChunked = array($this->fundingArray);
      foreach($fundingChunked as $fundingRay) {
        echo '<div class="fieldLabel">&nbsp;</div><div class="float50"><table class="tableChoices">';
        foreach($fundingRay as $item) {
          $isChecked = ( (isset($item['training_id']) && $item['training_id']) || ($this->is_new && $item['is_default']) ) ? ' checked' : '';
          echo '<tr><td valign="top">';
          echo '<input type="checkbox" name="funding_id[]" value="'.$item['id'].'" id="funding_id_'.$item['id'].'"'.$isChecked.' '.$this->viewonly.'> ';
          echo '</td><td valign="top">';
          echo '<label for="funding_id_'.$item['id'].'">'.$item['funding_phrase'].'</label>';
           echo '</td>';
          if($this->setting['display_funding_amounts']) {
             echo '<td valign="top" nowrap="nowrap">';
            echo '&nbsp;&nbsp;$&nbsp;<input type="text" onkeyup="updateTrainingCheck(\'funding_id_'.$item['id'].'\', \'funding_id_amount_'.$item['id'].'\')" size="6" name="funding_id_amount_'.$item['id'].'" value="'.(@$item['funding_amount']).'" id="funding_id_amount_'.$item['id'].'" '.$this->viewonly.' />';
            echo '</td>';
        }
         echo '</tr>';
        }
        echo '</table></div>';
      }

    ?>

  </div><br/><br clear="both" />

  <?php endif; ?>

  <?php if($this->setting['display_training_got_curric']) : ?>
  <div class="fieldLabel" id="training_got_cirriculum_option_id_lbl"><?php echo $this->translation['GOT Curriculum']; ?></div>
  <div class="fieldInput">
    <?php echo $this->dropDownGotCir; ?>
    <?php echo hasACLEdit('acl_editor_funding', 'admin/training-funding', $this); ?>
  </div><br/>
  <?php endif; ?>

  <?php if($this->setting['display_training_got_comment']) : ?>
  <div class="fieldLabel"><?php echo (@$this->translation['GOT Comment']); ?></div>
  <div class="fieldInput">
    <textarea name="got_comments"><?php echo $this->row['got_comments']; ?></textarea>
  </div><br/>
  <?php endif; ?>


	<?php if($this->setting['display_training_comments']){?>
  <div class="fieldLabel"><?php echo (@$this->translation['Training Comments']); ?></div>
  <div class="fieldInput">
    <textarea name="comments"><?php echo $this->row['comments']; ?></textarea>
  </div><br/>
  <?php }?>

  <?php if($this->setting['display_course_objectives']) : ?>
    <div class="fieldLabel"><?php echo $this->translation['Course Objectives']; ?></div>
    <div class="fieldInput">
      <textarea name="objectives"><?php echo $this->row['objectives']; ?></textarea>
    </div><br/>
  <?php endif; ?>

    <?php if ($this->setting['display_primary_language'] ) { ?>
    <div class="fieldLabel" id="training_primary_language_option_id_lbl"><?php echo $this->translation['Primary Language']; ?></div>
  <div class="fieldInput">
    <?php echo $this->dropDownPrimaryLanguage; ?>
  </div>
  <?php } ?>
   <?php if ($this->setting['display_secondary_language'] ) { ?>
    <div class="fieldLabel" id="training_secondary_language_option_id_lbl"><?php echo $this->translation['Secondary Language']; ?></div>
  <div class="fieldInput">
    <?php echo $this->dropDownSecondaryLanguage; ?>
  </div>
  <?php } ?>

  <?php if(!$this->viewonly && !$this->isIncomplete) : ?>
    <div class="actionBtn">
    <div class="clear yui-push-button">
      <button type="button" onclick="saveTraining();"><?php echo t('Save').' '.t('Training');?></button><br>
    </div>
    </div>
  <?php endif; ?>


  

<?php /************ TRAINERS ******************************************************************************/
if ( $this->row['has_known_participants']) : 
?>


<!-- TA:17: 09/03/2014 -->
	<?php if ( $this->setting['display_facilitator_info'] ) {?> 
	
	<div class="clear"></div>
  <div class="hrGrey"></div>
  <div class="clear"></div>
  
  <div class="fieldIndentNoMargin"><span class="required">*</span><?php echo t('Trainer').' '.t('Information');?> <span class="total"><?php echo t('Total').' '.t('Trainers').':';?> <span id="trainer_total">0</span></span></div>
  <div class="fieldIndent2">

      <div id="trainerTable"></div>
    <?php echo $this->tableTrainers; ?>

<?php if(!$this->viewonly) : ?>
    <br>
    <div>
    	<script>
    		function lastNameOnBlur(objRef) {
    			if(objRef.value=='')
    			objRef.value = "<?php echo $this->translation['Surname'];?>";
    		}
    		function lastNameOnFocus(objRef) {
				if(objRef.value=="<?php echo $this->translation['Surname'];?>")
				 objRef.value = '';
     		}
    		function firstNameOnBlur(objRef) {
    			if(objRef.value=='')
    			objRef.value = "<?php echo $this->translation['First Name'];?>";
    		}
    		function firstNameOnFocus(objRef) {
				if(objRef.value=="<?php echo $this->translation['First Name'];?>")
				 objRef.value = '';
     		}
   		function middleNameOnBlur(objRef) {
    			if(objRef.value=='')
    			objRef.value = "<?php echo $this->translation['Middle Name'];?>";
    		}
    		function middleNameOnFocus(objRef) {
				if(objRef.value=="<?php echo $this->translation['Middle Name'];?>")
				 objRef.value = '';
     		}
    	</script>
      <input type="text" id="trainer_first_name" size="15"  value="<?php echo $this->translation['First Name'];?>" onfocus="firstNameOnFocus(this)" onblur="firstNameOnBlur(this)">
   <?php if ( $this->setting['display_middle_name'] && !$this->setting['display_middle_name_last'] ) { ?>
      <input type="text" id="trainer_middle_name" size="15"  value="<?php echo $this->translation['Middle Name'];?>" onfocus="middleNameOnFocus(this)" onblur="middleNameOnBlur(this)">
	<?php } ?>
   	<input type="text" id="trainer_last_name" size="15"  value="<?php echo $this->translation['Surname'];?>" onfocus="lastNameOnFocus(this)" onblur="lastNameOnBlur(this)">
    <?php if ( $this->setting['display_middle_name'] && $this->setting['display_middle_name_last'] ) { ?>
      <input type="text" id="trainer_middle_name" size="15"  value="<?php echo $this->translation['Middle Name'];?>" onfocus="middleNameOnFocus(this)" onblur="middleNameOnBlur(this)">
	<?php }
        
        ?>
      <input type="hidden" id="trainer_days" value="0" >
          
      <!--<input type="text" id="trainer_days" size="3" value="" >&nbsp;<?php tp('days');?>-->
      &nbsp;&nbsp;&nbsp;
      <input type="hidden" id="trainer_id" value="0">
      <input type="hidden" id="is_trainer" value="0">
      <input type="button" value="<?php tp('Insert'); ?>" class="insert" onclick="addTrainer(this);return false;">
      &nbsp;&nbsp;&nbsp;
      <a href="javascript:submitThenRedirect('<?php echo $this->base_url;?>/person/add/trainingredirect/<?php echo $this->row['id']; ?>/maketrainer/1');"><?php tp('New Person Form');?></a>
    </div>

    <div style="z-index:9001;">
      <div id="trainerContainerFirst" class="autocomplete"  style="z-index:9001;"></div>
   <?php if ( $this->setting['display_middle_name'] && !$this->setting['display_middle_name_last'] ) { ?>
      <div id="trainerContainerMiddle" class="autocomplete" style="margin-left:135px;z-index:9001;"></div>
	<?php } ?>
      <div id="trainerContainer" class="autocomplete" style="margin-left:135px;z-index:9001;"></div>
   <?php if ( $this->setting['display_middle_name'] && $this->setting['display_middle_name_last'] ) { ?>
      <div id="trainerContainerMiddle" class="autocomplete" style="margin-left:135px;z-index:9001;"></div>
	<?php } ?>
    </div>

    <script type="text/javascript">
    YAHOO.util.Event.onDOMReady( function() {
    	      // last name
    	var autoComp = makeAutocomplete('trainer_last_name', 'trainerContainer', '<?php echo $this->base_url;?>/training/trainerLastList/outputType/text/' );
      formatNameAutocomplete(autoComp);
      YAHOO.util.Dom.get('trainerContainer').style.position = "absolute"; // fix position
      YAHOO.util.Dom.get('trainerContainer').style.top = '0px';

      // first name
    	var autoCompFirst = makeAutocomplete('trainer_first_name', 'trainerContainerFirst', '<?php echo $this->base_url;?>/training/trainerFirstList/outputType/text/' );
     formatNameAutocomplete(autoCompFirst);
      YAHOO.util.Dom.get('trainerContainerFirst').style.position = "absolute";
      YAHOO.util.Dom.get('trainerContainerFirst').style.top = '0px';

            // middle name
      <?php if ( $this->setting['display_middle_name'] ) {?>
    	var autoCompMiddle = makeAutocomplete('trainer_middle_name', 'trainerContainerMiddle', '<?php echo $this->base_url;?>/training/trainerMiddleList/outputType/text/' );
     formatNameAutocomplete(autoCompMiddle);
      YAHOO.util.Dom.get('trainerContainerMiddle').style.position = "absolute";
      YAHOO.util.Dom.get('trainerContainerMiddle').style.top = '0px';
      <?php } ?>

      // array can contain object references, element ids, or both
    	function suggestTrainerName( oSelf , elItem , oData ) {
    		var oTrainerFirst = YAHOO.util.Dom.get('trainer_first_name');
    		var oTrainerLast = YAHOO.util.Dom.get('trainer_last_name');
    		var oTrainerMiddle = YAHOO.util.Dom.get('trainer_middle_name');
    		var oTrainerId = YAHOO.util.Dom.get('trainer_id');
    		var oIsTrainer = YAHOO.util.Dom.get('is_trainer');

    		var midNameIdx =    2;
    		var lastNameIdx =   3;
    		<?php if ( $this->setting['display_middle_name'] ) { ?>
        midNameIdx =    <?php echo ( $this->setting['display_middle_name_last'] ? 3:2);?>;
        lastNameIdx =    <?php echo ( $this->setting['display_middle_name_last'] ? 2:3);?>;
        <?php }?>
    		oTrainerId.value = elItem[2][4];
    		oIsTrainer.value = elItem[2][5];
        if(elItem[0]._elTextbox == oTrainerLast) {
           oTrainerFirst.value = elItem[2][1];
           <?php if ( $this->setting['display_middle_name'] ) {?>
           oTrainerMiddle.value = elItem[2][midNameIdx];
           <?php }?>
           oTrainerLast.value = elItem[2][lastNameIdx];
       } else if(elItem[0]._elTextbox == oTrainerFirst) {
            oTrainerFirst.value = elItem[2][1];
            <?php if ( $this->setting['display_middle_name'] ) {?>
           oTrainerMiddle.value = elItem[2][midNameIdx];
           <?php }?>
           oTrainerLast.value = elItem[2][lastNameIdx];
        } else if(elItem[0]._elTextbox == oTrainerMiddle) {
           oTrainerFirst.value = elItem[2][1];
           <?php if ( $this->setting['display_middle_name'] ) {?>
           oTrainerMiddle.value = elItem[2][midNameIdx];
           <?php } ?>
           oTrainerLast.value = elItem[2][lastNameIdx];
      }

    		//YAHOO.util.Dom.get('trainer_days').focus();
    	};

    	autoComp.itemSelectEvent.subscribe(suggestTrainerName);
    	autoCompFirst.itemSelectEvent.subscribe(suggestTrainerName);
    	<?php if ( $this->setting['display_middle_name'] ) {?>
    	autoCompMiddle.itemSelectEvent.subscribe(suggestTrainerName);
    	<?php } ?>
    });
    	// fired on "insert" button click
    	function addTrainer(oButton) {

        var oTrainerFirst = YAHOO.util.Dom.get('trainer_first_name');
    		var oTrainerLast = YAHOO.util.Dom.get('trainer_last_name');
    		var oTrainerMiddle = YAHOO.util.Dom.get('trainer_middle_name');
    		 var oTrainerDays = YAHOO.util.Dom.get('trainer_days');
    		var oTrainerId = YAHOO.util.Dom.get('trainer_id');
    		var oIsTrainer = YAHOO.util.Dom.get('is_trainer');

    		if(oTrainerId.value == 0) {
          alert("<?php echo t('The entered').' '.t('trainer').' '.t('name could not be found.\n\nPlease select one from the list or add a new person.');?>");
          return;
        }

      //  if(oTrainerDays.value == "Days" || !oTrainerDays.value) {
    //      alert('<?php echo t('Please enter the number of days for this').' '.t('trainer').'.';?>');
    //   return;
    //    }
    <?php if (@$this->setting['require_trainer_skill']) : ?>
        if(oIsTrainer.value == 0) {
          if(confirm("<?php echo t('You must edit this person\'s').' '.t('trainer').' '.t('profile before adding them to this session.\n\nWould you like to do this now?');?>")) {
            submitThenRedirect('<?php echo $this->base_url;?>/person/edit/id/' + oTrainerId.value + '/trainingredirect/<?php echo $this->row['id']; ?>/maketrainer/1/days/1'  + '#training');
          }
          return;
        }
    <?php endif; ?>

        //oButton.disabled = true;

        var jsonAdd = { }
        jsonAdd.id = oTrainerId.value;
        jsonAdd.trainer_id = oTrainerId.value;
        jsonAdd.first_name = oTrainerFirst.value;
        <?php if ( $this->setting['display_middle_name'] ) {?>
        jsonAdd.middle_name = oTrainerMiddle.value;
        <?php } ?>
        jsonAdd.last_name = oTrainerLast.value;
        jsonAdd.duration_days = oTrainerDays.value;

        var successCallback = function() {
          oTrainerId.value = "0";
          oTrainerFirst.value = ""; oTrainerFirst.focus(); oTrainerFirst.blur();
          <?php if ($this->setting['display_middle_name'] ) { ?>
          oTrainerMiddle.value = ""; oTrainerMiddle.focus(); oTrainerMiddle.blur();
          <?php } ?>
          oTrainerLast.value = ""; oTrainerLast.focus(); oTrainerLast.blur();
          oTrainerDays.value = ""; oTrainerDays.focus(); oTrainerDays.blur();
          //oButton.disabled = false;
        }

        ITECH.trainerTable.addRow(jsonAdd, successCallback);

      }


    </script>

<?php endif; ?>

  </div>
  
  <?php }?>


<?php /************ PARTICIPANTS ******************************************************************************/ ?>

  <!--
  
    TP: using Jquery DataTable to render Participants List
  
  -->
      <br /><br />
      <input id="activeStatusText" type="hidden" value="all" />
      <span style="font-size: 11px;font-weight: bold; color:#696969;font-family: Arial, Helvetica, sans-serif;">Filter By Active status</span> 
        <select id="activeStatus" onchange="filterByActiveStatus()">
            <option value="all">All</option>
            <?php 
                                            //print_r($this->person_status);
                                          
                                            foreach($this->person_status as $pstatus){
                                                $titleShow = $pstatus['title'];
                                                $titleValue = strtolower(trim($pstatus['title']));
                                                echo '<option value="'.$titleShow.'">'.$titleShow.'</option>';
                                                if($pstatus['id']==1){
                                                 //   echo '<option value="inactive">All Inactive Providers</option>';
                                                }
                                            }
                                            ?>
        </select>
        <br /><br />
        
        <div style="text-align:right"><?php echo $this->printAndExport(); ?></div>
        <p id="loading_completed" style="display:none">Results displayed</p>
        <br /><br />
        
      <table id="participantTable2" data-page-length='50' class="display" cellspacing="0" width="100%">
          <thead>
              <tr>
                  <?php
                       $trainingHeader = $this->trainingPersonsHead;
                        if(isset($trainingHeader))
                        {
                            $output = "";
                            $thead = $this->trainingPersonsHead;
                            foreach($thead as $k=>$val )
                            {
                                $output .= '<th>'. $val .'</th>';
                            }
                            $output .='<th>Status</th>';
                            $output .= '<th></th>';
                            echo $output;
                        }
                  ?>
              </tr>
          </thead>
          <tbody id="tableBody">
                <?php
                    $trainingBody = $this->trainingPersons;
                    if(isset($trainingBody))
                    {
                      
                        $rowCounter = 1;
                        
                        $tbody = $trainingBody;
                        foreach($tbody as $k=>$tableRow)
                        {
                            
                           $rowid = 'row' . $rowCounter;
                          if(isset($tableRow['active']))
                          {
                              if($tableRow['active'] != "active" && strtolower($tableRow['active']) != "active provider" )
                              {
                                  if($tableRow['facility_name'] == null || $tableRow['region_c_name'] == 'unknown'
                                          || $tableRow['district_name'] == 'unknown' || $tableRow['region_c_name'] == null
                                          || $tableRow['district_name'] == null)
                                  {
                                      $row = sprintf('<tr class="gray-inactive highlight-facility tp-row" id="%s">',$rowid);
                                  }
                                  else{
                                  $row = sprintf('<tr class="gray-inactive tp-row" id="%s">',$rowid);
                                  }
                                  
                              }
                              else
                              {
                                  if($tableRow['facility_name'] == null || $tableRow['region_c_name'] == 'unknown'
                                          || $tableRow['district_name'] == 'unknown' || $tableRow['region_c_name'] == null
                                          || $tableRow['district_name'] == null)
                                  {
                                      $row = sprintf('<tr class="highlight-facility tp-row" id="%s">',$rowid);
                                  }
                                  else{
                                   $row = sprintf('<tr class="tp-row" id="%s" >',$rowid);
                                  }
                              }
                          }
                          else
                          {
                              $row = sprintf('<tr class="tp-row" id="%s">',$rowid);
                          }
                         
                           
                           $linkUrl = Settings::$COUNTRY_BASE_URL . '/person/edit/id/' . $tableRow['person_id'] ;
                           $linkInfo = sprintf("javascript:submitThenRedirect('%s/trainingredirect/%s')",$linkUrl,$this->training_id);
			   //$linkInfo  = "javascript:submitThenRedirect(".$linkUrl."/trainingredirect/$this->training_id');";
                           
                            $cert_colId = $rowid . 'col7';
                            $remove_colId = $rowid . 'col8';
                            
                           $removeFunc = sprintf('"removePersonFromTraining(%s,%s,%s);return false;"',$tableRow['person_id'],$this->training_id,$remove_colId);
                           
                           $row.= '<td><a href="'. $linkInfo.'">' .$tableRow['person_id'].'</a></td>';
                           $row.= "<td>" .$tableRow['first_name']. "</td>";
                           $row.= "<td>" .$tableRow['middle_name']. "</td>";
                           $row.= "<td>" .$tableRow['last_name']. "</td>";
                           $row.= "<td>" .$tableRow['district_name']. "</td>";
                           $row.= "<td>" .$tableRow['region_c_name']. "</td>";
                           $row.= "<td>" .$tableRow['facility_name']. "</td>";
                           $row.= "<td>" .$tableRow['qualification']. "</td>";
//                           $row.= "<td>" .$tableRow['Inactive']. "</td>";
                           $row.= "<td id=$cert_colId><div class='yui-dt-col-certification'>" .$tableRow['certification']. "</div></td>";
                           $row.="<td>".$tableRow['active']."</td>";
                           $row.= "<td  id=$remove_colId><a href='#' onclick=$removeFunc><div class='yui-dt-col-edit'>Remove</div></a></td>";
                           
                          $row .= "</tr>";
                          echo $row;
                          $rowCounter++;
                        }
                    }
                ?>
          </tbody>
      </table>
  
  
  
  
  
  
  <div class="clear"></div>
  <div class="hrGrey"></div>
  <div class="clear"></div>
  <div class="fieldIndentNoMargin">
     <?php tp(' Add Participants');?><br/><br/>
      <span class="required">*</span><?php tp('Participant Information');?> 
      <?php if($this->locationName=="all geography"){
         ?>
        <input type="hidden" name="updateParticipantCount" id="updateParticipantCount" value="<?php echo $this->participants_count; ?>" />  <span class="total" ><?php tp('Total Participants:');?><span id="totalPart"><?php echo $this->participants_count; ?></span></span> 
      <?php
          } else {
              if($this->personInJurisdiction<=0){
                  ?>
          &nbsp;&nbsp;&nbsp;
           <input type="hidden" name="updateParticipantCount" id="updateParticipantCount" value="<?php echo $this->participants_count; ?>" /><span class="total" id="totalPart"><?php tp('Total Participants:');?><span id="totalPart"><?php echo $this->participants_count; ?></span></span>
      
          <?php
              }else{
              ?>
       <input type="hidden" name="updateParticipantCount" id="updateParticipantCount" value="<?php echo $this->participants_count; ?>" /><span class="total"  style="float:right !important;padding-right:20% !important;"><?php tp('Total Participants:');?><span id="totalPart"><?php echo $this->participants_count; ?> </span></span>
      &nbsp;&nbsp;&nbsp;<span class="total" id="RecordExist"><?php echo 'Total Participants in '.$this->locationName.':';?> <span id="persons_total">0</span></span> 
      <?php
              }
              ?>
      
     
  
   <?php  }?>
  </div>
 <div class="fieldIndent2"><div id="noRecord"><b><span class="required">*</span> <i>You do not have the access right to view the information of participants in this training</i></b></div></div>
     
  <div class="fieldIndent2">
      <div id="personsTable" ></div>
      <!-- Tp: Participate List is being displayed here -->
      
      <?php echo $this->tablePersons; ?>

      
          
  
      <?php if(!$this->viewonly) : ?>
      <br/>
      <input type="text" id="person_first_name" size="15"  placeholder="<?php echo $this->translation['First Name'];?>" onfocus="firstNameOnFocus(this)" onblur="firstNameOnBlur(this)">
  <?php if ( $this->setting['display_middle_name'] && !$this->setting['display_middle_name_last'] ) { ?>
      <input type="text" id="person_middle_name" size="15"  placeholder="<?php echo $this->translation['Middle Name'];?>" onfocus="middleNameOnFocus(this)" onblur="middleNameOnBlur(this)">
   <?php } ?>
     <input type="text" id="person_last_name" size="15"  placeholder="<?php echo $this->translation['Last Name'];?>" onfocus="lastNameOnFocus(this)" onblur="lastNameOnBlur(this)">
  <?php if ( $this->setting['display_middle_name'] && $this->setting['display_middle_name_last'] ) { ?>
      <input type="text" id="person_middle_name" size="15"  value="<?php echo $this->translation['Middle Name'];?>" onfocus="middleNameOnFocus(this)" onblur="middleNameOnBlur(this)">
   <?php } ?>
       <input type="text" id="person_birthdate" size="9" disabled="true" value="<?php tp('Birthdate');?>" alt="Birthdate">
      <input type="text" id="person_facility" size="15" disabled="true" value="<?php tp('Facility');?>" alt="Facility">

 

 <?php
 //if ($this->setting [ 'display_region_c' ]) {
     // $location_title = $this->translation['Region C (Local Region)'];
    //  $location_idx = 10;
    //} else
     if ($this->setting [ 'display_region_b' ]) {
      $location_title = $this->translation['Region B (Health District)'];
      $location_idx = 10;
    } 
    if ($this->setting [ 'display_region_c' ]) {
      $location_titlereg = 'Local Government Area';
      $location_idreg = 9;
    }
    ////else {
    //  $location_title = $this->translation['Region A (Province)'];
     // $location_idx = 8;
   //// }
    ?>
          
       <input type="text" id="person_health" size="15" disabled="true" value="<?php echo $location_title;?>" alt="State" />
       <input type="text" id="person_regionc" size="15" disabled="true" value="<?php echo $location_titlereg;?>" alt="LGA" />
       <input type="text" id="person_cadre" size="15" disabled="true"  value="Cadre" alt="Cadre" />
      <input type="hidden" id="person_id" value="0" />

    <div>
      <div id="personContainerFirst" class="autoComplete" style="z-index: 9001;" ></div>
   <?php if ( $this->setting['display_middle_name'] && !$this->setting['display_middle_name_last'] ) { ?>
       <div id="personContainerMiddle" class="autoComplete" style="margin-left:135px;z-index: 9001;"></div>
   <?php } ?>
      <div id="personContainer" class="autoComplete" style="margin-left:135px;z-index: 9001;"></div>
   <?php if ( $this->setting['display_middle_name'] && $this->setting['display_middle_name_last'] ) { ?>
       <div id="personContainerMiddle" class="autoComplete" style="margin-left:135px;z-index: 9001;"></div>
   <?php } ?>
<br/>
<select name="certification" id="certification">
    <option value="">--certification--</option>
              <option value="N">No</option>
              <option value="Y">Yes</option>
          </select>
      <div class="actionBtn" style="float:right; margin-top: 10px;">
        <input type="button" name="Insert" value="<?php tp("Insert");?>" class="insert" id="personInsertButton" onclick="addPerson(this);return false;displayTable();">
       &nbsp;&nbsp;&nbsp;
        <!--<a href="javascript:submitThenRedirect('<?php //echo $this->base_url;?>/person/add/trainingredirect/<?php //echo $this->row['id']; ?>');"><?php // tp('New Person Form');?></a>-->
      </div>
  </div>
      



<script src="http://cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript">
    YAHOO.util.Event.onDOMReady( function() {
      // last name
      var personCountPerGeo = document.getElementById("personInJurisdiction").value;
      var real_total_participants = document.getElementById("real_total_participants").value;
      
     // alert(real_total_participants);
      if(personCountPerGeo<=0 && real_total_participants>0 &&  personCountPerGeo!=real_total_participants ){
          document.getElementById("noRecord").style.visbility = "visible";
      document.getElementById("noRecord").style.display = "block";
      
      
      document.getElementById("personsTable").style.visbility = "hidden";
      document.getElementById("personsTable").style.display = "none";
      
      
      
      
      
      }else{
     
      
      document.getElementById("personsTable").style.visbility = "visible";
      document.getElementById("personsTable").style.display = "block";
      
      document.getElementById("noRecord").style.visbility = "hidden";
      document.getElementById("noRecord").style.display = "none";
  
}
    	var autoCompPerson = makeAutocomplete('person_last_name', 'personContainer', '<?php echo $this->base_url;?>/training/personLastList/outputType/text/' );
      formatNameAutocomplete(autoCompPerson);
      YAHOO.util.Dom.get('personContainer').style.position = "absolute"; // fix position
      YAHOO.util.Dom.get('personContainer').style.top = '0px';

      // first name
    	var autoCompPersonFirst = makeAutocomplete('person_first_name', 'personContainerFirst', '<?php echo $this->base_url;?>/training/personFirstList/outputType/text/' );
      formatNameAutocomplete(autoCompPersonFirst);
      YAHOO.util.Dom.get('personContainerFirst').style.position = "absolute"; // fix position
      YAHOO.util.Dom.get('personContainerFirst').style.top = '0px';

           // middle name
      <?php if ( $this->setting['display_middle_name'] ) { ?>
    	var autoCompPersonMiddle = makeAutocomplete('person_middle_name', 'personContainerMiddle', '<?php echo $this->base_url;?>/training/personMiddleList/outputType/text/' );
      formatNameAutocomplete(autoCompPersonMiddle);
      YAHOO.util.Dom.get('personContainerMiddle').style.position = "absolute"; // fix position
      YAHOO.util.Dom.get('personContainerMiddle').style.top = '0px';
      <?php } ?>

  		var oPFirst = YAHOO.util.Dom.get('person_first_name');
  		var oPLast = YAHOO.util.Dom.get('person_last_name');
  		var oPMiddle = YAHOO.util.Dom.get('person_middle_name');
  		var oPBday = YAHOO.util.Dom.get('person_birthdate');
  		var oPFacility = YAHOO.util.Dom.get('person_facility');
  		var OPHealth = YAHOO.util.Dom.get('person_health');
                var OPregionC = YAHOO.util.Dom.get('person_regionc');
                var OPcadre = YAHOO.util.Dom.get('person_cadre');
  		var oPId = YAHOO.util.Dom.get('person_id');

      // array can contain object references, element ids, or both
    	function suggestPersonName( oSelf , elItem , oData ) {

        oPBday.value = elItem[2][7];
        oPFacility.value = elItem[2][5];
        OPHealth.value = elItem[2][<?php echo $location_idx;?>];
        OPregionC.value = elItem[2][<?php echo $location_idreg; ?>];
        OPcadre.value = elItem[2][8];
        oPId.value = elItem[2][4];

    		var midNameIdx =    <?php echo ( $this->setting['display_middle_name_last'] ? 3:2);?>;
    		var lastNameIdx =    <?php echo ( $this->setting['display_middle_name_last'] ? 2:3);?>;

        if(elItem[0]._elTextbox == oPLast) {
          oPFirst.value = elItem[2][1];
          <?php if ( $this->setting['display_middle_name'] ) {?>
          oPMiddle.value = elItem[2][midNameIdx];
          <?php } ?>
         oPLast.value = elItem[2][lastNameIdx];
       } else if(elItem[0]._elTextbox == oPFirst) {
          oPFirst.value = elItem[2][1];
          <?php if ( $this->setting['display_middle_name'] ) {?>
          oPMiddle.value = elItem[2][midNameIdx];
          <?php }?>
         oPLast.value = elItem[2][lastNameIdx];
        } else if(elItem[0]._elTextbox == oPMiddle) {
          oPFirst.value = elItem[2][1];
          <?php if ( $this->setting['display_middle_name'] ) {?>
          oPMiddle.value = elItem[2][midNameIdx];
          <?php }?>
         oPLast.value = elItem[2][lastNameIdx];
        }

        //addPerson(YAHOO.util.Dom.get('personInsertButton'));

    	};

    	autoCompPerson.itemSelectEvent.subscribe(suggestPersonName);
    	autoCompPersonFirst.itemSelectEvent.subscribe(suggestPersonName);
      <?php if ( $this->setting['display_middle_name'] ) { ?>
           	autoCompPersonMiddle.itemSelectEvent.subscribe(suggestPersonName);
      <?php } ?>

    	});
        
        //Javascript Helper functions
        String.format = function() {
        // The string containing the format items (e.g. "{0}")
        // will and always has to be the first argument.
        var theString = arguments[0];

        // start with the second argument (i = 1)
        for (var i = 1; i < arguments.length; i++) {
            // "gm" = RegEx options for Global search (more than one instance)
            // and for Multiline search
            var regEx = new RegExp("\\{" + (i - 1) + "\\}", "gm");
            theString = theString.replace(regEx, arguments[i]);
        }

        return theString;
        }
        
        
        function getFormattedDate()
        {
             Date.prototype.yyyymmdd = function() {
               var yyyy = this.getFullYear().toString();
               var mm = (this.getMonth()+1).toString(); // getMonth() is zero-based
               var dd  = this.getDate().toString();
               return yyyy + "-" + (mm[1]?mm:"0"+mm[0]) +"-" +(dd[1]?dd:"0"+dd[0]); // padding
              };

            d = new Date();
            return d.yyyymmdd();
        }
        
        function appendNewPersonRecord(fname,lname,middleName,facility,state,lga,qualification,certification,person_id,training_id,ptt_id)
        {
           var rowCount = $("#tableBody tr").length + 2; // Generate unique ID for the row in the participantTable
           var row = "<tr id='nrow-" + rowCount +  "' class='tp-row'>";
           
           var linkUrl = <?php echo '"'. Settings::$COUNTRY_BASE_URL . '/person/edit/id/' .'"'; ?> + person_id;
           var linkInfo = "javascript:submitThenRedirect('" + linkUrl + "/trainingredirect/" + training_id + "')";
          
           //$linkInfo  = "javascript:submitThenRedirect(".$linkUrl."/trainingredirect/$this->training_id');";

            var cert_colId =  "row"+rowCount + 'col7';
            var remove_colId = "row"+rowCount + 'col8';
            
           
            
            var removeFunc = "removePersonFromTraining(" + person_id + "," + training_id + "," +  remove_colId + ");";
            var popupFunc = String.format("popup('{0}','{1}',this)",person_id,certification);
            var anchor = String.format("<a href='#' onclick={0};{1} >Edit</a>",popupFunc,"return false;");
            var anchor2 = "<a href='#' onclick='popup(\""+ person_id + "\",\"" + certification + "\",this);return false'>EDIT</a>";
            console.log(anchor);
            console.log(anchor2);
           
           row += '<td><a href="'+ linkInfo + '">' + person_id + '</a></td>';
           row += "<td>" + fname + "</td>";
           row += "<td>" + middleName + "</td>";
           row += "<td>"  + lname +  "</td>";
           row += "<td>" + state + "</td>";
           row += "<td>" + lga + "</td>";
           row += "<td>" + facility + "</td>";
           row += "<td>" + qualification + "</td>";
           
           row += "<td id=" + cert_colId +  "><div class='yui-dt-col-certification'>" + certification + " &nbsp;&nbsp;" + anchor2 +  "</div></td>";
           row +="<td></td>";
           row += "<td  id=" + remove_colId + "><a href='#' onclick=" + removeFunc + "><div class='yui-dt-col-edit'>Remove</div></a></td>";

           row += "</tr>";
           
           return row;
        }
        
        //TP: this function resets the personAdd field below the participant list table
        function resetPersonAddField()
        {
            $("#person_first_name").val("");
            $("#person_last_name").val("");
            $("#person_middle_name").val("");
            
            var bdayAlt = $("#person_birthdate").attr("alt");
            $("#person_birthdate").val(bdayAlt);
            
            var facilityAlt = $("#person_facility").attr("alt");
            $("#person_facility").val(facilityAlt);
            
            var healthAlt = $("#person_health").attr("alt")
            $("#person_health").val(healthAlt);
            
            var lgaAlt = $("#person_regionc").attr("alt");
            $("#person_regionc").val(lgaAlt);
            
            var qualificationAlt = $("#person_cadre").attr("alt");
            $("#person_cadre").val(qualificationAlt);
            
            $("#certification").val("");
            $("#person_id").val("0");
        }
        
        
        function addPerson()
        {
            var fname = $("#person_first_name").val();
            var lname = $("#person_last_name").val();
            var middleName = $("#person_middle_name").val();
            var bday = $("#person_birthdate").val();
            var facility = $("#person_facility").val();
            var state = $("#person_health").val();
            var lga = $("#person_regionc").val();
            var qualification = $("#person_cadre").val();
            var certification = $("#certification").val();
            var person_id = $("#person_id").val();
            var training_level_option_id =  $("#training_level_option_id").val();
            var training_id = <?php echo $this->training_id; ?> ;
           
            
            var jsonData = {};
            
            jsonData.person_id = person_id;
            jsonData.training_id = training_id;
            jsonData.certification = certification;
            jsonData.timestamp_created = getFormattedDate();
            
            var personData = "person_id="+person_id+"&training_id="+training_id+"&certification="+certification+"&timestamp_created="+getFormattedDate()+"&training_level_option_id="+training_level_option_id;
            
            console.log(personData);
            
                if(person_id == 0)
                {
                    alert("The entered person could not be found, Select one from the list")
                    return;
                }
                
                var personCountPerGeo = document.getElementById("personInJurisdiction").value;
                    //var real_total_participants = document.getElementById("real_total_participants").value;
                 // alert(personCountPerGeo);



                  document.getElementById("personsTable").style.visbility = "visible";
                  document.getElementById("personsTable").style.display = "block";

                  document.getElementById("noRecord").style.visbility = "hidden";
                  document.getElementById("noRecord").style.display = "none";//
                  
                  <?php if ( !$this->setting['display_middle_name'] ) {?>
                          var middleName = "";
                    <?php } ?>
                        
                 
                 //TP: Ajax call to insert add new person to person-to-training table
                 <?php echo 'var postUrl = "'. $this->base_url . '/training/addNewptt";'; ?>
                 $.ajax({
                     type: "POST",
                     url: postUrl,
                     data: personData,
                     success: function(response){
                         //response is the lastInsertId of the person-to-trainng table
                         console.log(response);
                         var row = appendNewPersonRecord(fname,lname,middleName,facility,state,lga,qualification,certification,person_id,training_id,response);
                         //console.log("Record inserted succesfully : " + response);
                         dataTableObj.destroy();
                         $("#participantTable2 tbody").append(row);
                         dataTableObj = $("#participantTable2").DataTable(
                          {
                          "sPaginationType": "full_numbers",
                          "bDestroy": true,
                          "iDisplayLength": 50
                          });
                          
                            
                          
                           resetPersonAddField(); 
                     },
                     error: function(xhrObj,statusText,text){
                         console.log("Error : " + text);
                     }
                 })

           
        }
        
        
    	// fired on "insert" button click
    	function addPerson2(oButton) {
             
              
    	    var oPFirst = YAHOO.util.Dom.get('person_first_name');
    	      var oPLast = YAHOO.util.Dom.get('person_last_name');
    	      var oPMiddle = YAHOO.util.Dom.get('person_middle_name');
    	      var oPBday = YAHOO.util.Dom.get('person_birthdate');
    	      var oPFacility = YAHOO.util.Dom.get('person_facility');
    	      var OPHealth = YAHOO.util.Dom.get('person_health');
              var certify = YAHOO.util.Dom.get('certification');
              var OPregionC = YAHOO.util.Dom.get('person_regionc');
              var OPcadre = YAHOO.util.Dom.get('person_cadre');
              var oCertification = certify;//+"&nbsp;&nbsp;<a href='' id='editcertificationbutton' onclick='popup(\"$personToTrainingId\",\"$certify\");return false;'>Edit</a>";
    	      var oPId = YAHOO.util.Dom.get('person_id');

    		if(oPId.value == 0) {
          alert("<?php echo t('The entered person could not be found.\n\nPlease select one from the list or add a new person.'); ?>");
          return;
        }
        var personCountPerGeo = document.getElementById("personInJurisdiction").value;
        //var real_total_participants = document.getElementById("real_total_participants").value;
     // alert(personCountPerGeo);
     
      
      
      document.getElementById("personsTable").style.visbility = "visible";
      document.getElementById("personsTable").style.display = "block";
      
      document.getElementById("noRecord").style.visbility = "hidden";
      document.getElementById("noRecord").style.display = "none";//
      
        var jsonAdd = { }
        jsonAdd.id = oPId.value;
        jsonAdd.person_id = oPId.value;
        jsonAdd.last_name = oPLast.value;
        jsonAdd.first_name = oPFirst.value;
        <?php if ( $this->setting['display_middle_name'] ) {?>
        jsonAdd.middle_name = oPMiddle.value;
        <?php } ?>
        jsonAdd.birthdate = oPBday.value;
        jsonAdd.facility_name = oPFacility.value;
        jsonAdd.district_name = OPHealth.value;
        jsonAdd.region_c_name = OPregionC.value;
        jsonAdd.qualification = OPcadre.value;
        jsonAdd.certification = oCertification.value;
          //alert(jsonAdd.certification);
        var successCallback = function() {
          oPId.value = "0";
          oPFirst.value = ""; oPFirst.focus(); oPFirst.blur();
          oPLast.value = ""; oPLast.focus(); oPLast.blur();
          <?php if ( $this->setting['display_middle_name'] ) { ?>
                 oPMiddle.value = ""; oPMiddle.focus(); oPMiddle.blur();
          <?php } ?>
          oPBday.value = oPBday.alt;
          oPFacility.value = oPFacility.alt;
          OPHealth.value = OPHealth.alt;
          OPcadre.value = OPcadre.alt;
          oCertification.value = "";
         
         
        }
 
        ITECH.personsTable.addRow(jsonAdd, successCallback);
          
           
      }


    </script>

<?php endif; ?>

  </div>
  <!-- TA:17: 09/03/2014  -->
  <?php if(! $this->viewonly && $this->setting['display_training_score']) { ?> 
  <div class="fieldLabel"><label><?php tp('Participant Test Scores'); ?></label></div><div class="fieldInput"><a href="<?php echo $this->base_url; ?>/training/scores-import/training/<?php echo $this->row['id']; ?>"><?php tp('Import Scores'); ?></a></div>
  <?php } ?>
  <?php if($this->setting['display_training_pre_test'] || $this->setting['display_training_post_test']) : ?>
  <!-- test scores -->
    <div class="clear"></div>
    <div class="hrGrey"></div>
    <div class="clear"></div>
    <div class="fieldIndentNoMargin"><?php tp('Course Average Test Scores');?></div>
    <div class="fieldIndent2">

      <?php if($this->setting['display_training_pre_test']) : ?>
        <?php echo $this->translation['Pre Test Score']; ?>
        <input type="text" size="8" name="pre" value="<?php echo $this->row['pre']; ?>"  <?php echo $this->viewonly; ?>>
        &nbsp;
      <?php endif; ?>
      <?php if($this->setting['display_training_post_test']) : ?>
        <?php echo $this->translation['Post Test Score']; ?>
        <input type="text" size="8" name="post" value="<?php echo $this->row['post']; ?>"  <?php echo $this->viewonly; ?>>
      <?php endif; ?>

    </div>

  <?php endif; ?>

  <?php endif; //$this->has_known_participants  ?>
 <?php if (!$this->row['has_known_participants']) :  ?>
	   <script  type="text/javascript">

	   <?php $num_qual_quantities = 1;
		   foreach ($this->unknownQualDropDowns as $dd) {
		   	if ( $dd['quantity_na'] ) $num_qual_quantities++;
        else if ( $dd['quantity_male'] ) $num_qual_quantities++;
		    else if ( $dd['quantity_female'] ) $num_qual_quantities++;
		   }

	   ?>
	   var qual_cnt = <?php print $num_qual_quantities;?>;

	    function  showQualCallback() {
	    	var qualElement =  YAHOO.util.Dom.get( 'training_qualification_item_' + qual_cnt);
	    	if ( qualElement ) {
	    		qualElement.style.display = 'block';
			qual_cnt++;
	    	}
	    	return false;
	    }

	    function calculate_quantity() {
	    	var num = 0;
	    	var qualElement;
	    	var elementNum;
	    	for(var n = 0;  n < qual_cnt; n++) {
	    		elementNum = num;
	    		qualElement =  YAHOO.util.Dom.get( 'qualification_quantity_na_' + n);
	    		if ( parseInt(qualElement.value) > 0 ) {
	    			num = num + parseInt(qualElement.value);
	    		}
	            qualElement =  YAHOO.util.Dom.get( 'qualification_quantity_male_' + n);
	            if ( parseInt(qualElement.value) > 0 ) {
	              num = num + parseInt(qualElement.value);
	            }
	            qualElement =  YAHOO.util.Dom.get( 'qualification_quantity_female_' + n);
	            if ( parseInt(qualElement.value) > 0 ) {
	              num = num + parseInt(qualElement.value);
	            }

	         qualType = YAHOO.util.Dom.get( 'select_person_qualification_option_' + n);
	         if ( (elementNum != num) && (qualType.selectedIndex == 0)) {
	        	  alert('<?php tp('You need to choose a cadre for all recorded participants.');?>');
		       }
	    	}

	    	var totalElement =  YAHOO.util.Dom.get( 'total');
	    	totalElement.innerHTML = num;

	    }

	    YAHOO.util.Event.onDOMReady(calculate_quantity);
	</script>

    <div class="fieldIndentNoMargin"><?php tp('Participant Qualifications'); ?></div>
 	<?php
 	$i = 0;
 	foreach ($this->unknownQualDropDowns as $dd) { ?>
   	<div class="fieldIndent2" style="display: <?php print (($i < $num_qual_quantities)?'block;':'none;') ?>;" id="training_qualification_item_<?php echo $i;?>" >
	<?php echo ($dd['select']).'&nbsp;';
   echo t('Age Range').':<select name="age_range_option_id[]" id="age_range_option_id_'.$i.'" >';
   foreach($this->age_options as $ao) {
   	echo "<option value='{$ao['id']}' ".($dd['age_range_option_id'] == $ao['id']?"selected='selected'":"").">{$ao['age_range_phrase']}</option>";
   }
   echo '</select>&nbsp;';
	 echo t('Male').':<input type="text" size="6" name="qualification_quantity_male[]" id="qualification_quantity_male_'.$i.'" onfocus="this.select();" onchange="calculate_quantity();" value="'.($dd['quantity_male']?$dd['quantity_male']:'').'" />&nbsp;';
   echo t('Female').':<input type="text" size="6" name="qualification_quantity_female[]" id="qualification_quantity_female_'.$i.'" onfocus="this.select();" onchange="calculate_quantity();" value="'.($dd['quantity_female']?$dd['quantity_female']:'').'" />&nbsp;';
	 echo t('Unknown').':<input type="text" size="6" name="qualification_quantity_na[]" id="qualification_quantity_na_'.$i.'" onfocus="this.select();" onchange="calculate_quantity();" value="'.($dd['quantity_na']?$dd['quantity_na']:'').'" />';
   echo '<br/>'; ?>
	</div>
	<?php
	$i++;
 	} ?><br/>
	<div  class="fieldIndent2" ><a href="#" onclick="return showQualCallback();" id="add_qual">Add another qualification</a>&nbsp;&nbsp;<div style="display: inline;"><label>Total</label>&nbsp;<label id="total">0</label></div></div>
<?php endif; //$this->has_known_participants  ?>

  <?php if($this->setting['display_training_custom1']) : ?>
    <!-- custom field 1 -->

    <div class="clear"></div>
    <div class="hrGrey"></div>
    <div class="clear"></div>

    <div class="fieldIndentNoMargin"><?php echo $this->translation['Training Custom 1']; ?></div>
    <div class="fieldIndent2">
          <input type="text" name="custom1_phrase" size="60" value="<?php echo $this->row['custom1_phrase']; ?>">
    </div>
  <?php endif; ?>

  <?php if($this->setting['display_training_custom2']) : ?>
    <!-- custom field 2 -->

    <div class="clear"></div>
    <div class="hrGrey"></div>
    <div class="clear"></div>

    <div class="fieldIndentNoMargin"><?php echo $this->translation['Training Custom 2']; ?></div>
    <div class="fieldIndent2">
          <input type="text" name="custom2_phrase" size="60" value="<?php echo $this->row['custom2_phrase']; ?>">
    </div>
  <?php endif; ?>

  <?php if($this->setting['display_training_custom3']) : ?>
    <!-- custom field 3 -->

    <div class="clear"></div>
    <div class="hrGrey"></div>
    <div class="clear"></div>

    <div class="fieldIndentNoMargin"><?php echo $this->translation['Training Custom 3']; ?></div>
    <div class="fieldIndent2">
          <input type="text" name="custom3_phrase" size="60" value="<?php echo $this->row['custom_3']; ?>">
    </div>
  <?php endif; ?>

  <?php if($this->setting['display_training_custom4']) : ?>
    <!-- custom field 4 -->

    <div class="clear"></div>
    <div class="hrGrey"></div>
    <div class="clear"></div>

    <div class="fieldIndentNoMargin"><?php echo $this->translation['Training Custom 4']; ?></div>
    <div class="fieldIndent2">
          <input type="text" name="custom4_phrase" size="60" value="<?php echo $this->row['custom_4']; ?>">
    </div>
  <?php endif; ?>


	<?php if ( $this->setting['module_approvals_enabled']) : ?>
    <div class="clear"></div>
    <div class="hrGrey"></div>
    <div class="clear"></div>
  	<div class="fieldIndentNoMargin"><?php tp('Approval Status'); ?></div>
	<div class="fieldIndentNoMargin">
		<div class="fieldLabel"><?php tp('Approved'); ?></div><input type="radio" name="approval_status" value="approved" <?php if ($this->approve_val) {echo 'checked';} ?> <?php echo $this->approve_disable_str;?> />
	</div>
	<div class="fieldIndentNoMargin">
		<div class="fieldLabel"><?php tp('Rejected'); ?></div><input type="radio" name="approval_status" value="rejected" <?php if (!$this->row['is_approved']) {echo 'checked';} ?> <?php echo $this->approve_disable_str;?> />
	</div>
	<?php if ( !$this->row['is_approved'] and (array_search('approve_trainings',$this->identity->acls) !== false) ) { ?>
	<div class="clear"></div>
	<label><?php tp('Comments'); ?></label>
	<textarea name="approval_comments" cols="80"></textarea>
	<?php } ?>
	<?php endif; ?>



  <input type="hidden" name="redirectUrl" id="redirectUrl" value=""/>
  <input type="hidden" name="specialAction" id="specialAction" value=""/>
  <input type="hidden" name="training_id" id="training_id" value=""/>

   <?php if(!$this->viewonly) : ?>
  <style>
      #submitTraining.yui-button.yui-push-button
      {
          background-color: transparent;
      }
      span.first-child {
         height: 19px;
         line-height:19px;
      }
  </style>
   <div class="actionBtn" style="height:2px;line-height:2px">
    <button  type="button" id="submitTraining" onclick="saveTraining()"><?php echo t('Save').' '.t('Training');?></button><br>
   </div>
   <?php endif; ?>

</form></div> <!-- table ends -->

<div class="clear"></div>

<!-- TA:17: 09/09/2014 -->
    <?php if ( $this->hasACL ( 'admin_files' ) && !$this->hasACL ( 'admin_files' ) ) {?>
    <div class="hrGrey"></div>
    <div class="clear"></div>
    <div class="fieldIndentNoMargin"><?php tp('Attached Documents'); ?></div>
    <div class="fieldIndent2">
      <?php echo $this->editTableFiles; ?>
      <span class="caption"><?php tp('Right-click and select "Save Target As..." to download.');?></span>
    </div>
    
    <?php if($this->filesForm) : ?>
    <div class="fieldIndentNoMargin"><?php tp('Document Upload'); ?></div>
    <div class="fieldIndent2">
      <?php echo $this->filesForm; ?>
    </div>
<script type="text/javascript">
YAHOO.util.Event.on(window, 'load', initUploadButton);
</script>
    <?php endif; ?>
    <?php }?>


</div>

<script type="text/javascript">
<?php
// onready - add ajax submit
	if(!$this->viewonly) {
		if ( $this->mode != 'add') {
			echo "addAjaxSubmit('submitTraining','trainingForm','".$this->base_url."/training/edit/id/".$this->row['id']."/outputType/json');".PHP_EOL;
		} else {
			echo "addAjaxSubmit('submitTraining','trainingForm','".$this->base_url."/training/add/outputType/json');".PHP_EOL;
		}
	}

?>

var documentHasChanged = false;

function monitorChanges (e) {
  documentHasChanged = true;
}

$(document).ready ( function () {
  $('#trainingForm select').click(monitorChanges);
  $('#trainingForm input').change(monitorChanges);
  
  $('#loading_completed:hidden').toggle();
});

// submitThenRedirect()
function submitThenRedirect(url) {
  var fld = document.getElementById('redirectUrl');
  fld.value = url;

  if (!documentHasChanged)
    return window.location = url;

	if (confirm("<?php tp('You are moving to a new page, do you wish to save the changes you\'ve made?');?>"))
    saveTraining();
  else
    window.location = url;
}

function deleteTraining() {
	  var personsTable = ITECH.personsTable;
	  var trainerTable = ITECH.trainerTable;
          var updatedParticipantsValue = document.getElementById("updateParticipantCount").value;
         
                if(updatedParticipantsValue<1)
                {
                           if(confirm("<?php tp("Are you sure you wish to delete this training session?"); ?>")) 
                           {
                             YAHOO.util.Dom.get('specialAction').value = "delete";
                            YAHOO.util.Dom.get('training_id').value = "<?php echo $this->row['id']; ?>";
                             YAHOO.util.Dom.get('redirectUrl').value = "<?php echo $this->base_url;?>/training/deleted";
                            // alert("delete this dude");
                            deleteForms();
                            }
                }
		else if ( <?php
    echo ($this->row['has_known_participants']  ? '(trainerTable != undefined &&  (trainerTable.myDataTable.getRecordSet().getLength() != 0)) || (personsTable != undefined && (personsTable.myDataTable.getRecordSet().getLength() != 0))': ' (YAHOO.util.Dom.get("qualification_quantity_na_0").value > 0) || (YAHOO.util.Dom.get("qualification_quantity_female_0").value > 0) || (YAHOO.util.Dom.get("qualification_quantity_male_0").value > 0) ');  ?> ) {
		alert('<?php echo t('All trainers and participants must be removed before deleting a training session.'); ?>');
	}
        else if(updatedParticipantsValue>0){
            alert('<?php echo t('All trainers and participants must be removed before deleting a training session.'); ?>');
        }
//        else if(confirm("<?php tp("Are you sure you wish to delete this training session?"); ?>"))
//        {
//             YAHOO.util.Dom.get('specialAction').value = "delete";
//             YAHOO.util.Dom.get('training_id').value = "<?php echo $this->row['id']; ?>";
//            YAHOO.util.Dom.get('redirectUrl').value = "<?php echo $this->base_url;?>/training/deleted";
//            // alert("delete this dude");
//            deleteForms();
//        }
}

// duplicate training confirm
function duplicateTraining() {
	if(confirm("<?php echo t('Duplicate this').' '.t('Training').'?'; ?>")) {
      YAHOO.util.Dom.get('specialAction').value = "duplicate";
     saveTraining();
    }
}

// submit form via ajax
function submitForm() {
<?php if ( $this->mode != 'add') {
      echo 'var postUrl = "'. $this->base_url . '/training/edit/id/'.$this->row['id'].'/outputType/json"';
} else {
      echo 'var postUrl = "' . $this->base_url . '/training/add/outputType/json"';
} ?>
 
  var buttonId = 'submitTraining';
  var formId = 'trainingForm';
  (function() {
    //var _button = new YAHOO.widget.Button(buttonId);
    var handleSuccess = function(o) {
      try {
          
        var response = o.responseText;
        alert(responseText);
        var responseObj = jQuery.parseJSON(response);
        alert(responseObj.messages);
       displayStatus(responseObj.status);
        var allGood = true;
        if ( responseObj.messages ) {
          for (var key in responseObj.messages) {
            displayErrorMessage(key,responseObj.messages[key]);
            allGood = false;
          }
        }
        if(!allGood) {
          setStatusBoxError();
        }

        if ( responseObj.obj_id ) {
          var new_obj_field =  YAHOO.util.Dom.get('obj_id');
          if ( new_obj_field ) {
            new_obj_field.value = responseObj.obj_id;
          }
        }

        var redir = document.getElementById('redirectUrl');
        if(redir.value != '' && allGood){
          window.location =  redir.value;
        } else if ( responseObj.redirect ) {
          window.location = responseObj.redirect;
        }
      }
      catch (x) {

        alert("temp ITech script error: " + x);

        alert(response);
        return;
      }

      document.body.style.cursor = "auto";

    }
    var handleFailure = function(o) {
      alert("Submission failed with code: " + o.status + ". The error text is: " + o.statusText);
      document.body.style.cursor = "auto";
    }

    var callback = {
      success: handleSuccess,
      failure: handleFailure
    };

      window.setTimeout(function() {

        //document.body.style.cursor = "wait";

        //clear error text
        var els = YAHOO.util.Dom.getElementsByClassName('errorText');
        if ( els.length )
          YAHOO.util.Dom.setStyle(els, 'display', 'none');
        var formObject = document.getElementById(formId);
        //alert(formObject);
        YAHOO.util.Connect.setForm(formObject);
        var request = YAHOO.util.Connect.asyncRequest('POST', postUrl, callback);
      }, 200);

  })();
  }

//var participants = $("#participantTable2 tbody tr");
//                            
//console.log("Table length = " + participants.length);
</script>

</div>

<div id="footer"><?php require_once('views/scripts/footer.phtml');?></div>
</body>
</html>
